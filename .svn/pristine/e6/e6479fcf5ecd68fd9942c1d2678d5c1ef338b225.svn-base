package com.alpha.self.diagnosis.controller;

import com.alpha.commons.core.service.SysSequenceService;
import com.alpha.commons.web.ResponseMessage;
import com.alpha.commons.web.ResponseStatus;
import com.alpha.commons.web.WebUtils;
import com.alpha.self.diagnosis.pojo.vo.BasicQuestionVo;
import com.alpha.self.diagnosis.service.DiagnosisService;
import com.alpha.self.diagnosis.service.MedicineQuestionService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;

/**
 * Created by xc.xiong on 2017/9/1.
 * 问诊流程
 */
@RestController
@RequestMapping("/diagnosis")
public class DiagnosisController {

    private static final Logger LOGGER = LoggerFactory.getLogger(DiagnosisController.class);

    @Resource
    private DiagnosisService diagnosisService;

    @Resource
    private MedicineQuestionService medicineQuestionService;

    /**
     * 开始问诊，生成问诊编号
     *
     * @param userId 用户本人编号
     * @param inType 渠道标识
     * @return diagnosisId  唯一诊断编号
     */
    @PostMapping("/start")
    public ResponseMessage diagnosisStart(Long userId, Integer inType) {
        LOGGER.info("生成问诊编号,为导诊做准备: {} {}", userId, inType);
        BasicQuestionVo firstQuestion = diagnosisService.start(userId, inType);
        return WebUtils.buildSuccessResponseMessage(firstQuestion);
    }

    /**
     * 循环获取下一个问题
     * 接受答案信息
     * 如果没有问题编号，从第一个开始
     * @param userId 用户本人编号
     * @param inType 渠道标识
     * @return diagnosisId  唯一诊断编号
     */
    @PostMapping("/next")
    public ResponseMessage diagnosisNext(Long userId, Integer inType, Integer diagnosisId, Integer questionId, String answers) {
        LOGGER.info("循环获取下一个问题: {} {} {}", userId,questionId, answers);
        if (diagnosisId == null)
            return new ResponseMessage(ResponseStatus.INVALID_VALUE);

        return new ResponseMessage(diagnosisId);
    }


    @PostMapping("/test/question")
    public ResponseMessage medicineQuestion() {
        BasicQuestionVo basicQuestionVo = medicineQuestionService.question();
        return new ResponseMessage(basicQuestionVo);
    }

}
